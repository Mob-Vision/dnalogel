import{f as te,w as B}from"./mockData-2a386b6f.js";import{f as z,i as H,g as A,h as w,k as x,l as h,m as I,n as k,o as C,q as j,t as Z,v as ne,w as R,x as ae,y as re,z as U,C as E,E as P,H as M,I as d,J as b,K as y,L as oe,N as $,Q as ee,U as ie,X as se,r as D,u as le,a as fe,F as N,j as W,B as ce,c as me,d as ue,p as ge,e as he,R as pe}from"./vendor-862c62a4.js";import{C as J,B as de,R as _e,f as be,a as L}from"./RoomHighlight-6e9c024c.js";import{g as ve}from"./getInitialParamFromUrl-f6979ec1.js";function we(a,e=200){let t;return function(...n){t||(a(...n),t=setTimeout(function(){t=null},e))}}function xe(a){let e,t,n;return{c(){e=w("div"),t=w("div"),n=w("div"),x(n,"class","plugin-radar__camera-rotate svelte-o7uo2v"),h(n,"background-image","url("+(a[0]||J)+")"),h(n,"transform",a[1],!1),x(t,"class","plugin-radar__camera-position svelte-o7uo2v"),h(t,"transform",a[2],!1),x(e,"class","plugin-radar__camera-wrapper svelte-o7uo2v")},m(r,o){I(r,e,o),k(e,t),k(t,n)},p(r,[o]){o&1&&h(n,"background-image","url("+(r[0]||J)+")"),o&2&&h(n,"transform",r[1],!1),o&4&&h(t,"transform",r[2],!1)},i:C,o:C,d(r){r&&j(e)}}}function Ie(a,e,t){let{five:n}=e,{pxmm:r}=e,{floorplanData:o}=e,{cameraImageUrl:s}=e;function m(g){const _=o.observers[g],v=o.bounding,p=(v.max.x-v.min.x)*r,F=(v.max.y-v.min.y)*r;if(!_)return"";const S=Math.floor(_.positionInImage.x*p),O=Math.floor(_.positionInImage.y*F);return`translate(${S}px, ${O}px)`}function u(){const{longitude:g}=n.getCurrentState();return`rotate(${Math.floor(g/Math.PI*180)*-1+45}deg)`}const f=g=>{t(2,l=m(g))},i=we(()=>{t(1,c=u())},1e3/60);let c=u(),l=m(n.getCurrentState().panoIndex);return Z(()=>{n.on("panoWillArrive",f),n.on("cameraDirectionUpdate",i)}),ne(()=>{n.off("panoWillArrive",f),n.off("cameraDirectionUpdate",i)}),a.$$set=g=>{"five"in g&&t(3,n=g.five),"pxmm"in g&&t(4,r=g.pxmm),"floorplanData"in g&&t(5,o=g.floorplanData),"cameraImageUrl"in g&&t(0,s=g.cameraImageUrl)},[s,c,l,n,r,o]}class je extends z{constructor(e){super();H(this,e,Ie,xe,A,{five:3,pxmm:4,floorplanData:5,cameraImageUrl:0})}}function G(a,e,t){const n=a.slice();return n[1]=e[t],n}function K(a,e){let t,n,r=`${e[1].icon.width/16}rem`,o=`${e[1].icon.height/16}rem`,s,m=`${e[1].positionInImage.y*100}%`,u=`${e[1].positionInImage.x*100}%`;return{key:a,first:null,c(){t=w("div"),n=w("div"),s=R(),x(n,"class","plugin-pano-floorplan__extra-object-item svelte-8n0d4v"),h(n,"background-image",`url(${e[1].icon.url})`),h(n,"width",r,!1),h(n,"height",o,!1),x(t,"class","plugin-pano-floorplan__extra-object-item--position svelte-8n0d4v"),h(t,"top",m,!1),h(t,"left",u,!1),this.first=t},m(f,i){I(f,t,i),k(t,n),k(t,s)},p(f,i){e=f,i&1&&h(n,"background-image",`url(${e[1].icon.url})`),i&1&&r!==(r=`${e[1].icon.width/16}rem`)&&h(n,"width",r,!1),i&1&&o!==(o=`${e[1].icon.height/16}rem`)&&h(n,"height",o,!1),i&1&&m!==(m=`${e[1].positionInImage.y*100}%`)&&h(t,"top",m,!1),i&1&&u!==(u=`${e[1].positionInImage.x*100}%`)&&h(t,"left",u,!1)},d(f){f&&j(t)}}}function Oe(a){let e,t=[],n=new Map,r=a[0];const o=s=>s[1].id;for(let s=0;s<r.length;s+=1){let m=G(a,r,s),u=o(m);n.set(u,t[s]=K(u,m))}return{c(){e=w("div");for(let s=0;s<t.length;s+=1)t[s].c();x(e,"class","plugin-pano-floorplan__extra-objects svelte-8n0d4v")},m(s,m){I(s,e,m);for(let u=0;u<t.length;u+=1)t[u].m(e,null)},p(s,[m]){m&1&&(r=s[0],t=ae(t,m,o,1,s,r,n,e,re,K,null,G))},i:C,o:C,d(s){s&&j(e);for(let m=0;m<t.length;m+=1)t[m].d()}}}function De(a,e,t){let{extraObjects:n=[]}=e;return a.$$set=r=>{"extraObjects"in r&&t(0,n=r.extraObjects)},[n]}class ke extends z{constructor(e){super();H(this,e,De,Oe,A,{extraObjects:0})}}function Q(a){let e,t;const n=[{five:a[0],pxmm:a[1],floorIndex:a[2],floorplanData:a[4],onRoomHeightClick:a[6]}];let r={};for(let o=0;o<n.length;o+=1)r=U(r,n[o]);return e=new _e({props:r}),{c(){E(e.$$.fragment)},m(o,s){P(e,o,s),t=!0},p(o,s){const m=s&87?M(n,[{five:o[0],pxmm:o[1],floorIndex:o[2],floorplanData:o[4],onRoomHeightClick:o[6]}]):{};e.$set(m)},i(o){t||(d(e.$$.fragment,o),t=!0)},o(o){b(e.$$.fragment,o),t=!1},d(o){y(e,o)}}}function Ee(a){let e,t,n,r,o,s;const m=[{floorIndex:a[2],floorplanData:a[4]}];let u={};for(let i=0;i<m.length;i+=1)u=U(u,m[i]);e=new de({props:u}),n=new ke({props:{extraObjects:a[5]}});let f=a[3]&&Q(a);return{c(){E(e.$$.fragment),t=R(),E(n.$$.fragment),r=R(),f&&f.c(),o=oe()},m(i,c){P(e,i,c),I(i,t,c),P(n,i,c),I(i,r,c),f&&f.m(i,c),I(i,o,c),s=!0},p(i,[c]){const l=c&20?M(m,[{floorIndex:i[2],floorplanData:i[4]}]):{};e.$set(l);const g={};c&32&&(g.extraObjects=i[5]),n.$set(g),i[3]?f?(f.p(i,c),c&8&&d(f,1)):(f=Q(i),f.c(),d(f,1),f.m(o.parentNode,o)):f&&($(),b(f,1,1,()=>{f=null}),ee())},i(i){s||(d(e.$$.fragment,i),d(n.$$.fragment,i),d(f),s=!0)},o(i){b(e.$$.fragment,i),b(n.$$.fragment,i),b(f),s=!1},d(i){y(e,i),i&&j(t),y(n,i),i&&j(r),f&&f.d(i),i&&j(o)}}}function Pe(a,e,t){let n,{five:r}=e,{pxmm:o}=e,{floorIndex:s}=e,{hoverEnable:m}=e,{floorplanData:u}=e,{extraObjects:f=[]}=e;const i=void 0;return a.$$set=c=>{"five"in c&&t(0,r=c.five),"pxmm"in c&&t(1,o=c.pxmm),"floorIndex"in c&&t(2,s=c.floorIndex),"hoverEnable"in c&&t(3,m=c.hoverEnable),"floorplanData"in c&&t(4,u=c.floorplanData),"extraObjects"in c&&t(7,f=c.extraObjects)},a.$$.update=()=>{a.$$.dirty&132&&t(5,n=f?.filter(c=>c.floorIndex===s))},[r,o,s,m,u,n,i,f]}class ye extends z{constructor(e){super();H(this,e,Pe,Ee,A,{five:0,pxmm:1,floorIndex:2,hoverEnable:3,floorplanData:4,extraObjects:7})}}function V(a){let e,t,n,r,o=`${a[7]}px`,s=`${a[10]}px`,m;const u=[{five:a[0],pxmm:a[8],floorIndex:a[9],floorplanData:a[2],hoverEnable:a[1],extraObjects:a[4]}];let f={};for(let l=0;l<u.length;l+=1)f=U(f,u[l]);t=new ye({props:f});const i=[{pxmm:a[8],five:a[0],floorplanData:a[2],cameraImageUrl:a[3]}];let c={};for(let l=0;l<i.length;l+=1)c=U(c,i[l]);return r=new je({props:c}),{c(){e=w("div"),E(t.$$.fragment),n=R(),E(r.$$.fragment),x(e,"class","plugin-floorplan-radar-container svelte-7d8ub2"),h(e,"width",o,!1),h(e,"height",s,!1)},m(l,g){I(l,e,g),P(t,e,null),k(e,n),P(r,e,null),m=!0},p(l,g){const _=g&791?M(u,[{five:l[0],pxmm:l[8],floorIndex:l[9],floorplanData:l[2],hoverEnable:l[1],extraObjects:l[4]}]):{};t.$set(_);const v=g&269?M(i,[{pxmm:l[8],five:l[0],floorplanData:l[2],cameraImageUrl:l[3]}]):{};r.$set(v),g&128&&o!==(o=`${l[7]}px`)&&h(e,"width",o,!1),g&1024&&s!==(s=`${l[10]}px`)&&h(e,"height",s,!1)},i(l){m||(d(t.$$.fragment,l),d(r.$$.fragment,l),m=!0)},o(l){b(t.$$.fragment,l),b(r.$$.fragment,l),m=!1},d(l){l&&j(e),y(t),y(r)}}}function Fe(a){let e,t,n,r=a[5]!==0&&V(a);return{c(){e=w("div"),r&&r.c(),x(e,"class","plugin-floorplan-radar svelte-7d8ub2"),ie(()=>a[11].call(e))},m(o,s){I(o,e,s),r&&r.m(e,null),t=se(e,a[11].bind(e)),n=!0},p(o,[s]){o[5]!==0?r?(r.p(o,s),s&32&&d(r,1)):(r=V(o),r.c(),d(r,1),r.m(e,null)):r&&($(),b(r,1,1,()=>{r=null}),ee())},i(o){n||(d(r),n=!0)},o(o){b(r),n=!1},d(o){o&&j(e),r&&r.d(),t()}}}function Se(a,e,t){let{five:n}=e,{hoverEnable:r}=e,{floorplanData:o}=e,{cameraImageUrl:s}=e,{extraObjects:m=[]}=e,u=0,f=0,i=0,c=0,l=0,g=0;function _(p){t(9,f=n.work.observers[p].floorIndex)}Z(()=>(n.on("panoArrived",_),()=>{n.off("panoArrived",_)}));function v(){i=this.clientWidth,c=this.clientHeight,t(5,i),t(6,c)}return a.$$set=p=>{"five"in p&&t(0,n=p.five),"hoverEnable"in p&&t(1,r=p.hoverEnable),"floorplanData"in p&&t(2,o=p.floorplanData),"cameraImageUrl"in p&&t(3,s=p.cameraImageUrl),"extraObjects"in p&&t(4,m=p.extraObjects)},a.$$.update=()=>{if(a.$$.dirty&228){const p=Math.min(i,c),{max:F,min:S}=o.bounding,O=F.x-S.x,T=F.y-S.y,q=function(){return O>T?[p,p/O*T]:[p/T*O,p]}();t(7,l=q[0]),t(10,g=q[1]),t(8,u=l/O)}},[n,r,o,s,m,i,c,l,u,f,g,v]}class Ce extends z{constructor(e){super();H(this,e,Se,Fe,A,{five:0,hoverEnable:1,floorplanData:2,cameraImageUrl:3,extraObjects:4})}}class Re{app;five;wrapperSelector="";data;wrapper=null;extraObjects;originExtraObjects;configs={};constructor(e,t){this.five=e,t?.configs&&Object.assign(this.configs,t.configs),typeof t?.wrapper=="string"?this.wrapperSelector=t.wrapper:t?.wrapper instanceof Element&&(this.wrapper=t.wrapper),e.once("dispose",this.dispose)}dispose=()=>{this.app?.$destroy()};load=async e=>{const t=JSON.parse(JSON.stringify(e)),n=await be(t);this.data=n,this.render()};appendTo(e){this.wrapper=e,this.render()}changeConfigs(e){Object.assign(this.configs,e),this.render()}setExtraObjectsWith3DPositions(e){this.originExtraObjects=e,!!this.data&&(this.extraObjects=L(e,this.five,this.data),this.render())}render(){if(!this.wrapper){const t=document.querySelector(this.wrapperSelector);this.wrapper=t}if(!this.data||!this.wrapper)return;!this.extraObjects&&this.originExtraObjects&&(this.extraObjects=L(this.originExtraObjects,this.five,this.data));const e={five:this.five,floorplanData:this.data,extraObjects:this.extraObjects,cameraImageUrl:this.configs.cameraImageUrl,hoverEnable:this.configs.hoverEnable??!1};if(!this.app){this.app=new Ce({target:this.wrapper,props:e});return}this.app.$set(e)}}const Ue=(a,e)=>new Re(a,e);function X(){return{width:window.innerWidth,height:window.innerHeight}}function Me(){const[a,e]=D.exports.useState(X);return D.exports.useEffect(()=>{const t=()=>e(X());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),a}const We=()=>{const[a,e]=le(),t=fe(),n=D.exports.useRef(null),[r,o]=D.exports.useState(!1);return D.exports.useEffect(()=>{!n.current||a.mode!==N.Mode.Panorama||(t.plugins.panoFloorplanRadarPlugin.appendTo(n.current),t.plugins.panoFloorplanRadarPlugin.load(te))},[]),D.exports.useEffect(()=>{a.mode===N.Mode.Panorama?o(!0):o(!1)},[a.mode]),W(ce,{onClick:()=>e({mode:N.Mode.Floorplan}),sx:{display:`${r?"flex":"none"}`,justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"90px",height:"120px",backgroundColor:"rgba(0, 0, 0, .2)"},ref:n})},ze={},Y=ve(),He=JSON.stringify(Y)!=="{}"?Y:ze,Ae=me({plugins:[[Ue,"panoFloorplanRadarPlugin",{...He}]]}),Te=()=>{const a=Me();return B&&ue(Ae,{initialWork:ge(B),ref:e=>Object.assign(window,{$five:e?.five}),children:[W(he,{...a}),W(We,{})]})};pe.render(W(Te,{}),document.querySelector("#app"));
