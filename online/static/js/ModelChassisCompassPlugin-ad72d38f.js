import"./BetterTween-5a481d88.js";import{aj as L,ak as D,al as E,am as k,an as A,r as g,u as O,a as U,b as I,a9 as W,F as m,j as r,aa as N,d as w,ab as X,ac as h,ad as H,ae as T,c as Y,p as $,e as q,R as Z}from"./vendor-9221c96b.js";import"./constants-39e3873d.js";import{t as G}from"./transfromToMeshBasicMaterial-b13c8bcd.js";import{f as J,w as v}from"./mockData-a850cee4.js";const p=(e,n,a)=>{const o=new L,t=new D(e,n,a,"YXZ");return o.makeRotationFromEuler(t),o},K=(e,{scale:n,rotation:a,position:o})=>{if(n&&e.scale.set(n,n,n),a){const[t,d,c]=a;t&&e.applyMatrix4(p(t,0,0)),d&&e.applyMatrix4(p(0,d,0)),c&&e.applyMatrix4(p(0,0,c))}return o&&e.position.set(o.x,o.y,o.z),e},Q=(e,n)=>{const a=n.fbx_url||"//vrlab-static.ljcdn.com/release/web/v3/dipan3/dipan.FBX",o=n.north_rad||void 0,t={},d=async s=>{const i=s?.fbx_url||a,l=s?.north_rad||o;if(!l)throw new Error('"northRad"\u914D\u7F6E\u53C2\u6570\u7F3A\u5931\uFF1A\u672A\u914D\u7F6E\u6307\u5357\u9488\u6307\u5411\uFF01');const u=e.model.bounding,y=u.max.x-u.min.x,F=u.max.z-u.min.z,_=Math.max(y,F),f=await new E().loadAsync(i);G(f,{transparent:!0,side:k,blending:A});const j=[0,l-Math.PI/2,0],{model:{bounding:{max:{x:C,z},min:{x:P,y:b,z:R}}}}=e;t.yBase=b;const B={x:(C+P)/2,y:b-1.6,z:(z+R)/2},S=.0045*_;return K(f,{position:B,rotation:j,scale:S}),t.object=f,!0},c=({latitude:s})=>{if(!t.object)return;const i=x(s);i&&(t.object.position.y=i)},x=s=>{if(t.yBase===void 0)return;const i=.6;if(s>=Math.PI/4)return t.yBase-(i+1.6);const l=s*(4/Math.PI);return t.yBase-(i*l+1.6)};return{load:d,disable:()=>{!t.object||(e.scene.remove(t.object),e.needsRender=!0,e.off("cameraDirectionUpdate",c))},enable:()=>{if(!t.object)return;const s=x(e.getPose().latitude);s&&(t.object.position.y=s),e.scene.add(t.object),e.needsRender=!0,e.on("cameraDirectionUpdate",c)}}};function M(){return{width:window.innerWidth,height:window.innerHeight}}function V(){const[e,n]=g.exports.useState(M);return g.exports.useEffect(()=>{const a=()=>n(M());return window.addEventListener("resize",a,!1),()=>window.removeEventListener("resize",a,!1)}),e}const ee=J?.computed_data?.entrance?.north_rad,te=()=>{const[e,n]=O(),a=U(),o=I();return W("modelLoaded",async()=>{await a.plugins.modelChassisCompassPlugin.load({north_rad:ee}),n({panoIndex:0,fov:106,latitude:-.07983208586321928,longitude:1.52265306535823,mode:m.Mode.Floorplan}),a.plugins.modelChassisCompassPlugin.enable()}),o!=="Loaded"?null:r(N,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:w(X,{showLabels:!0,value:e.mode,onChange:(t,d)=>{n({mode:d})},children:[r(h,{label:"\u5168\u666F\u6F2B\u6E38",icon:r(H,{}),value:m.Mode.Panorama}),r(h,{label:"\u7A7A\u95F4\u603B\u89C8",icon:r(T,{}),value:m.Mode.Floorplan})]})})},ne=Y({plugins:[[Q,"modelChassisCompassPlugin",{}]]}),ae=()=>{const e=V();return v&&w(ne,{initialWork:$(v),ref:n=>Object.assign(window,{$five:n?.five}),children:[r(q,{...e}),r(te,{})]})};Z.render(r(ae,{}),document.querySelector("#app"));
