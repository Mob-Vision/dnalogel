import{V as c,S as P,aq as k,ar as j,an as q,al as H,as as I,M as L}from"./vendor-5f3df8df.js";import{t as N}from"./transformPositionToVector3-c92e9764.js";function z(n,e){const m=Math.round(n);return m%2===0?m:m+Number(e?.smaller?-1:1)}function V(n,e){return new c((n.x+e.x)/2,(n.y+e.y)/2,(n.z+e.z)/2)}function U(n,e){if(!e||typeof ResizeObserver>"u")return{observe:()=>window.addEventListener("resize",n),unobserve:()=>window.removeEventListener("resize",n)};{const m=new ResizeObserver(n);return{observe:()=>m.observe(e),unobserve:()=>m.unobserve(e)}}}const Z=n=>{const e={disposeCallbacks:[]},m=(...o)=>{const E=o[0].map(d=>d instanceof c?d:N(d)),i=o[1];if(E?.length<4)return console.error("points must be equal or greater than than 4");if(!n?.model?.loaded)return console.error("five.model.loaded is: ",n?.model?.loaded);const a=n.getElement();if(!a)return console.error("five.getElement() is "+a);const b=[],x=i?.ratio||.00216;x<=.00215&&console.warn("if you need click css3DElement on safari, ratio must be greater than 0.00215");const D=i?.dpr||1,l=i?.mode||"front",p=i?.autoRender??!0,C=i?.behindFiveContainer||a.parentElement||document.body,s=i?.container||document.createElement("div");s.classList.add("__Dnalogel-plugin--CSS3DRenderPlugin");const{css3DObject:u,mesh:r}=F(E,{ratio:x,dpr:D,container:s,mode:l});let f;const w=l==="front"&&!e.frontMode,v=l==="behind"&&!e.behindMode,R=!(w||v);let M=!1,g=null;v&&(e.behindMode={scene:new P,css3DRenderer:new k}),w&&(e.frontMode={scene:new P,css3DRenderer:new k});const{scene:h,css3DRenderer:t}=l==="behind"?e.behindMode:e.frontMode,S=(()=>{if(R)return()=>{h.add(u)};{const d=()=>{const W=z(a.clientWidth,{smaller:!0}),T=z(a.clientHeight,{smaller:!0});t.setSize(W,T)};d(),f=U(d,a),t.domElement.style.position="absolute",t.domElement.style.top="0",t.domElement.style.userSelect="none",t.domElement.style.pointerEvents="none";const A=()=>{M||(g=requestAnimationFrame(A),t.render(h,n.camera))};return()=>{h.add(u),f?.observe?.(),A(),l==="behind"&&r&&(n.scene.add(r),b.push(()=>r&&n.scene.remove(r)))}}})();w&&(a.parentElement||document.body).appendChild(t.domElement),v&&C.appendChild(t.domElement);const y=()=>(M=!0,b.forEach(d=>d?.()),h.remove(u),typeof g=="number"&&cancelAnimationFrame(g),h.children.length===0&&(t.domElement.remove(),l==="front"&&(e.frontMode=void 0),l==="behind"&&(e.behindMode=void 0),!e.behindMode&&!e.frontMode&&f?.unobserve?.()),!0),O=e.disposeCallbacks.findIndex(d=>d===y);return O!==-1?e.disposeCallbacks.splice(O,1):e.disposeCallbacks.push(y),p&&S(),{container:s,dispose:y,css3DObject:u,render:p?void 0:S}},F=(o,E)=>{const{ratio:i,dpr:a,container:b,mode:x}=E,D=o[0].distanceTo(o[1]),l=o[1].distanceTo(o[2]),p=z(D/i*a),C=z(l/i*a),s=new j(b);s.scale.set(i,i,i),b.style.width=p+"px",b.style.height=C+"px",b.style.pointerEvents="none";const u=V(o[0],o[2]),r=o[1].clone().sub(o[0]),f=o[2].clone().sub(o[1]),w=new c(0,1,0).angleTo(new c(0,f.y,f.z)),v=new c(1,0,0).angleTo(new c(r.x,0,r.z)),R=r.angleTo(new c(r.x,0,r.z)),M=(f.z>0?-1:1)*w,g=(r.z<0?1:-1)*v,h=(r.x>0&&r.y<0||r.x<0&&r.y>0?-1:1)*R;s.rotateOnWorldAxis(new c(1,0,0),M),s.rotateOnWorldAxis(new c(0,1,0),g),s.rotateOnWorldAxis(new c(0,0,1),h),s.position.set(u.x,u.y,u.z);let t;if(x==="behind"){const S=new q({opacity:0,transparent:!1,side:H}),y=new I(p,C);t=new L(y,S),t.name="CSS3DRenderPlugin-mesh",t.position.copy(s.position),t.rotation.copy(s.rotation),t.scale.copy(s.scale)}return{css3DObject:s,mesh:t}};return{create3DDomContainer:m,disposeAll:()=>{e.disposeCallbacks.forEach(o=>o?.()),e.disposeCallbacks=[]}}};export{Z as C};
