import{f as b,w as p}from"./mockData-390f2e53.js";import{r as d,a as x,u as M,b as E,j as i,aa as F,d as w,ab as S,ac as c,ad as C,F as u,ae as y,c as I,p as L,e as T,B as D,R as A}from"./vendor-6e04d41e.js";import"./typing-9caf697c.js";import{f as W}from"./RoomHighlight-504e1ed1.js";import{o as z,c as v,g as O,M as _}from"./changeModelCanvasOpacity-c8cde88c.js";import"./loadTexture-b2c90048.js";import"./constants-6d6c99de.js";import{g as k}from"./getInitialParamFromUrl-f6979ec1.js";const G={position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:"10"};class N{size={width:0,height:0};visible=!1;pxmm=0;app;five;panoIndex=0;floorIndex=0;configs={};lastPanoramaLongitude=0;selector;floorplanData;wrapper;container=document.createElement("div");constructor(e,t){this.five=e,this.selector=t.selector,this.configs=z(t,["selector"]),this.container.classList.add("floorplan-plugin"),Object.assign(this.container.style,G),this.five.model.loaded?this.handleModelLoaded():e.once("modelLoaded",this.handleModelLoaded),this.five.once("dispose",this.dispose),this.five.on("modeChange",this.handleModeChange),this.five.on("panoArrived",this.handlePanoArrived),this.five.on("initAnimationEnded",this.handleInitAnimationEnded),this.five.on("modelShownFloorChange",this.onModelShownFloorChange)}async load(e){const t=JSON.parse(JSON.stringify(e));this.floorplanData=await W(t),this.render()}appendTo(e){return this.wrapper=e,e.appendChild(this.container),this}dispose=()=>{this.hide(),this.container?.remove(),this.app?.$destroy(),this.five.off("modeChange",this.handleModeChange),this.five.off("panoArrived",this.handlePanoArrived),this.five.off("modelLoaded",this.handleModelLoaded),this.five.off("wantsMoveToPano",this.handleWantsMoveToPano),this.five.off("wantsPanGesture",this.handleWantsPanGesture),this.five.off("initAnimationEnded",this.handleInitAnimationEnded),this.five.off("modelShownFloorChange",this.onModelShownFloorChange)};onModelShownFloorChange=e=>{e!==null&&(this.floorIndex=e,this.updateSize(),this.render())};handlePanoArrived=e=>{!this.five?.work||(this.panoIndex=e,this.floorIndex=this.five.work.observers[e].floorIndex)};handleWantsMoveToPano=()=>{if(!!this.visible&&this.configs.preventRoomClick)return!1};handleWantsPanGesture=()=>{if(!!this.visible)return!1};handleModelLoaded=()=>{if(this.wrapper||!this.selector)return;const e=this.selector instanceof Element?this.selector:document.querySelector(this.selector);if(!e)throw new Error("\u4E0D\u6B63\u786E\u7684\u7236\u5BB9\u5668\u9009\u62E9\u5668");this.wrapper=e,e.append(this.container)};handleModeChange=e=>{if(e!=="Topview")return this.hide()};handleInitAnimationEnded=()=>{const{mode:e}=this.five.getCurrentState();e==="Topview"&&this.show()};show(){this.visible=!0,this.five.model.show(this.floorIndex),this.updateSize();const e=500,t=this.configs.modelOpacity;typeof t=="number"&&v(this.five,t,e),this.render(e),this.five.on("wantsMoveToPano",this.handleWantsMoveToPano),this.five.on("wantsPanGesture",this.handleWantsPanGesture)}hide(){this.visible=!1,v(this.five,1,0),this.render(),this.five.on("wantsMoveToPano",this.handleWantsMoveToPano),this.five.on("wantsPanGesture",this.handleWantsPanGesture)}updateSize=()=>{if(!this.floorplanData||!this.container||!this.wrapper||this.five.getCurrentState().mode!=="Topview")return;const{min:e,max:t}=this.floorplanData.bounding,s=t.x-e.x,a=t.y-e.y,r=this.configs.attachedTo?{attachedTo:this.configs.attachedTo}:void 0,o=O(this.five,this.wrapper,this.floorIndex,r),l=Math.ceil(s*o),h=Math.ceil(a*o);this.pxmm=o,this.size={width:l,height:h},this.container.style.width=l+"px",this.container.style.height=h+"px"};render(e){if(!this.container||!this.floorplanData||this.size.width===0)return;const{getLabelElement:t,cameraImageUrl:s,preventRoomClick:a,hoverEnable:r,compassEnable:o,roomLabelsEnable:l,ruleLabelsEnable:h}=this.configs,P=a?()=>!1:void 0,f={five:this.five,pxmm:this.pxmm,cameraImageUrl:s,visible:this.visible,duration:e??0,panoIndex:this.panoIndex,floorIndex:this.floorIndex,floorplanData:this.floorplanData,hoverEnable:r??!1,compassEnable:o??!0,ruleLabelsEnable:h??!0,roomLabelsEnable:l??!0,lastPanoramaLongitude:this.lastPanoramaLongitude,getLabelElement:t,onRoomHeightClick:P};this.app?this.app.$set(f):this.app=new _({target:this.container,intro:!0,props:f})}}const R=(n,e)=>new N(n,e);function m(){return{width:window.innerWidth,height:window.innerHeight}}function B(){const[n,e]=d.exports.useState(m);return d.exports.useEffect(()=>{const t=()=>e(m());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),n}const j=n=>{const e=x(),[t,s]=M(),a=E();return d.exports.useEffect(()=>{e.plugins.topviewFloorplanPlugin.load(b)},[]),a!=="Loaded"?null:i(F,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},className:"topview-floorplan-plugin-use",children:w(S,{showLabels:!0,value:t.mode,onChange:(r,o)=>{s({mode:o})},children:[i(c,{label:"\u5168\u666F\u6F2B\u6E38",icon:i(C,{}),value:u.Mode.Panorama}),i(c,{label:"\u4FEF\u89C6\u6A21\u578B",icon:i(y,{}),value:u.Mode.Topview})]})})},U={hoverEnable:!0},g=k(),$=JSON.stringify(g)!=="{}"?g:U,J=I({plugins:[[R,"topviewFloorplanPlugin",{selector:".plugin-full-screen-container",...$}]]}),q=()=>{const n=B();return p&&w(J,{initialWork:L(p),ref:e=>Object.assign(window,{$five:e?.five}),children:[i(T,{...n}),i(D,{className:"plugin-full-screen-container",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),i(j,{})]})};A.render(i(q,{}),document.querySelector("#app"));
