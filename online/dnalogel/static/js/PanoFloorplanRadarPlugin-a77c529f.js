import{f as te,w as B}from"./mockData-390f2e53.js";import{g as z,i as H,h as A,k as w,l as x,m as h,n as I,o as k,q as R,t as j,v as Z,w as ne,x as C,y as ae,z as re,E as U,H as E,I as P,J as M,K as d,L as b,N as y,Q as oe,U as $,X as ee,Y as ie,Z as se,r as D,u as le,a as fe,F as N,j as W,B as ce,c as me,d as ue,p as ge,e as he,R as pe}from"./vendor-6e04d41e.js";import"./typing-9caf697c.js";import{C as J,B as de,R as _e,f as be,a as L}from"./RoomHighlight-504e1ed1.js";import{t as ve}from"./throttle-19b08aa2.js";import"./loadTexture-b2c90048.js";import"./constants-6d6c99de.js";import{g as we}from"./getInitialParamFromUrl-f6979ec1.js";function xe(r){let e,t,n;return{c(){e=w("div"),t=w("div"),n=w("div"),x(n,"class","plugin-radar__camera-rotate svelte-o7uo2v"),h(n,"background-image","url("+(r[0]||J)+")"),h(n,"transform",r[1],!1),x(t,"class","plugin-radar__camera-position svelte-o7uo2v"),h(t,"transform",r[2],!1),x(e,"class","plugin-radar__camera-wrapper svelte-o7uo2v")},m(a,o){I(a,e,o),k(e,t),k(t,n)},p(a,[o]){o&1&&h(n,"background-image","url("+(a[0]||J)+")"),o&2&&h(n,"transform",a[1],!1),o&4&&h(t,"transform",a[2],!1)},i:R,o:R,d(a){a&&j(e)}}}function Ie(r,e,t){let{five:n}=e,{pxmm:a}=e,{floorplanData:o}=e,{cameraImageUrl:s}=e;function m(g){const _=o.observers[g],v=o.bounding,p=(v.max.x-v.min.x)*a,F=(v.max.y-v.min.y)*a;if(!_)return"";const S=Math.floor(_.positionInImage.x*p),O=Math.floor(_.positionInImage.y*F);return`translate(${S}px, ${O}px)`}function u(){const{longitude:g}=n.getCurrentState();return`rotate(${Math.floor(g/Math.PI*180)*-1+45}deg)`}const f=g=>{t(2,l=m(g))},i=ve(()=>{t(1,c=u())},1e3/60);let c=u(),l=m(n.getCurrentState().panoIndex);return Z(()=>{n.on("panoWillArrive",f),n.on("cameraDirectionUpdate",i)}),ne(()=>{n.off("panoWillArrive",f),n.off("cameraDirectionUpdate",i)}),r.$$set=g=>{"five"in g&&t(3,n=g.five),"pxmm"in g&&t(4,a=g.pxmm),"floorplanData"in g&&t(5,o=g.floorplanData),"cameraImageUrl"in g&&t(0,s=g.cameraImageUrl)},[s,c,l,n,a,o]}class je extends z{constructor(e){super();H(this,e,Ie,xe,A,{five:3,pxmm:4,floorplanData:5,cameraImageUrl:0})}}function G(r,e,t){const n=r.slice();return n[1]=e[t],n}function K(r,e){let t,n,a=`${e[1].icon.width/16}rem`,o=`${e[1].icon.height/16}rem`,s,m=`${e[1].positionInImage.y*100}%`,u=`${e[1].positionInImage.x*100}%`;return{key:r,first:null,c(){t=w("div"),n=w("div"),s=C(),x(n,"class","plugin-pano-floorplan__extra-object-item svelte-8n0d4v"),h(n,"background-image",`url(${e[1].icon.url})`),h(n,"width",a,!1),h(n,"height",o,!1),x(t,"class","plugin-pano-floorplan__extra-object-item--position svelte-8n0d4v"),h(t,"top",m,!1),h(t,"left",u,!1),this.first=t},m(f,i){I(f,t,i),k(t,n),k(t,s)},p(f,i){e=f,i&1&&h(n,"background-image",`url(${e[1].icon.url})`),i&1&&a!==(a=`${e[1].icon.width/16}rem`)&&h(n,"width",a,!1),i&1&&o!==(o=`${e[1].icon.height/16}rem`)&&h(n,"height",o,!1),i&1&&m!==(m=`${e[1].positionInImage.y*100}%`)&&h(t,"top",m,!1),i&1&&u!==(u=`${e[1].positionInImage.x*100}%`)&&h(t,"left",u,!1)},d(f){f&&j(t)}}}function Oe(r){let e,t=[],n=new Map,a=r[0];const o=s=>s[1].id;for(let s=0;s<a.length;s+=1){let m=G(r,a,s),u=o(m);n.set(u,t[s]=K(u,m))}return{c(){e=w("div");for(let s=0;s<t.length;s+=1)t[s].c();x(e,"class","plugin-pano-floorplan__extra-objects svelte-8n0d4v")},m(s,m){I(s,e,m);for(let u=0;u<t.length;u+=1)t[u].m(e,null)},p(s,[m]){m&1&&(a=s[0],t=ae(t,m,o,1,s,a,n,e,re,K,null,G))},i:R,o:R,d(s){s&&j(e);for(let m=0;m<t.length;m+=1)t[m].d()}}}function De(r,e,t){let{extraObjects:n=[]}=e;return r.$$set=a=>{"extraObjects"in a&&t(0,n=a.extraObjects)},[n]}class ke extends z{constructor(e){super();H(this,e,De,Oe,A,{extraObjects:0})}}function Q(r){let e,t;const n=[{five:r[0],pxmm:r[1],floorIndex:r[2],floorplanData:r[4],onRoomHeightClick:r[6]}];let a={};for(let o=0;o<n.length;o+=1)a=U(a,n[o]);return e=new _e({props:a}),{c(){E(e.$$.fragment)},m(o,s){P(e,o,s),t=!0},p(o,s){const m=s&87?M(n,[{five:o[0],pxmm:o[1],floorIndex:o[2],floorplanData:o[4],onRoomHeightClick:o[6]}]):{};e.$set(m)},i(o){t||(d(e.$$.fragment,o),t=!0)},o(o){b(e.$$.fragment,o),t=!1},d(o){y(e,o)}}}function Ee(r){let e,t,n,a,o,s;const m=[{floorIndex:r[2],floorplanData:r[4]}];let u={};for(let i=0;i<m.length;i+=1)u=U(u,m[i]);e=new de({props:u}),n=new ke({props:{extraObjects:r[5]}});let f=r[3]&&Q(r);return{c(){E(e.$$.fragment),t=C(),E(n.$$.fragment),a=C(),f&&f.c(),o=oe()},m(i,c){P(e,i,c),I(i,t,c),P(n,i,c),I(i,a,c),f&&f.m(i,c),I(i,o,c),s=!0},p(i,[c]){const l=c&20?M(m,[{floorIndex:i[2],floorplanData:i[4]}]):{};e.$set(l);const g={};c&32&&(g.extraObjects=i[5]),n.$set(g),i[3]?f?(f.p(i,c),c&8&&d(f,1)):(f=Q(i),f.c(),d(f,1),f.m(o.parentNode,o)):f&&($(),b(f,1,1,()=>{f=null}),ee())},i(i){s||(d(e.$$.fragment,i),d(n.$$.fragment,i),d(f),s=!0)},o(i){b(e.$$.fragment,i),b(n.$$.fragment,i),b(f),s=!1},d(i){y(e,i),i&&j(t),y(n,i),i&&j(a),f&&f.d(i),i&&j(o)}}}function Pe(r,e,t){let n,{five:a}=e,{pxmm:o}=e,{floorIndex:s}=e,{hoverEnable:m}=e,{floorplanData:u}=e,{extraObjects:f=[]}=e;const i=void 0;return r.$$set=c=>{"five"in c&&t(0,a=c.five),"pxmm"in c&&t(1,o=c.pxmm),"floorIndex"in c&&t(2,s=c.floorIndex),"hoverEnable"in c&&t(3,m=c.hoverEnable),"floorplanData"in c&&t(4,u=c.floorplanData),"extraObjects"in c&&t(7,f=c.extraObjects)},r.$$.update=()=>{r.$$.dirty&132&&t(5,n=f?.filter(c=>c.floorIndex===s))},[a,o,s,m,u,n,i,f]}class ye extends z{constructor(e){super();H(this,e,Pe,Ee,A,{five:0,pxmm:1,floorIndex:2,hoverEnable:3,floorplanData:4,extraObjects:7})}}function V(r){let e,t,n,a,o=`${r[7]}px`,s=`${r[10]}px`,m;const u=[{five:r[0],pxmm:r[8],floorIndex:r[9],floorplanData:r[2],hoverEnable:r[1],extraObjects:r[4]}];let f={};for(let l=0;l<u.length;l+=1)f=U(f,u[l]);t=new ye({props:f});const i=[{pxmm:r[8],five:r[0],floorplanData:r[2],cameraImageUrl:r[3]}];let c={};for(let l=0;l<i.length;l+=1)c=U(c,i[l]);return a=new je({props:c}),{c(){e=w("div"),E(t.$$.fragment),n=C(),E(a.$$.fragment),x(e,"class","plugin-floorplan-radar-container svelte-7d8ub2"),h(e,"width",o,!1),h(e,"height",s,!1)},m(l,g){I(l,e,g),P(t,e,null),k(e,n),P(a,e,null),m=!0},p(l,g){const _=g&791?M(u,[{five:l[0],pxmm:l[8],floorIndex:l[9],floorplanData:l[2],hoverEnable:l[1],extraObjects:l[4]}]):{};t.$set(_);const v=g&269?M(i,[{pxmm:l[8],five:l[0],floorplanData:l[2],cameraImageUrl:l[3]}]):{};a.$set(v),g&128&&o!==(o=`${l[7]}px`)&&h(e,"width",o,!1),g&1024&&s!==(s=`${l[10]}px`)&&h(e,"height",s,!1)},i(l){m||(d(t.$$.fragment,l),d(a.$$.fragment,l),m=!0)},o(l){b(t.$$.fragment,l),b(a.$$.fragment,l),m=!1},d(l){l&&j(e),y(t),y(a)}}}function Fe(r){let e,t,n,a=r[5]!==0&&V(r);return{c(){e=w("div"),a&&a.c(),x(e,"class","plugin-floorplan-radar svelte-7d8ub2"),ie(()=>r[11].call(e))},m(o,s){I(o,e,s),a&&a.m(e,null),t=se(e,r[11].bind(e)),n=!0},p(o,[s]){o[5]!==0?a?(a.p(o,s),s&32&&d(a,1)):(a=V(o),a.c(),d(a,1),a.m(e,null)):a&&($(),b(a,1,1,()=>{a=null}),ee())},i(o){n||(d(a),n=!0)},o(o){b(a),n=!1},d(o){o&&j(e),a&&a.d(),t()}}}function Se(r,e,t){let{five:n}=e,{hoverEnable:a}=e,{floorplanData:o}=e,{cameraImageUrl:s}=e,{extraObjects:m=[]}=e,u=0,f=0,i=0,c=0,l=0,g=0;function _(p){t(9,f=n.work.observers[p].floorIndex)}Z(()=>(n.on("panoArrived",_),()=>{n.off("panoArrived",_)}));function v(){i=this.clientWidth,c=this.clientHeight,t(5,i),t(6,c)}return r.$$set=p=>{"five"in p&&t(0,n=p.five),"hoverEnable"in p&&t(1,a=p.hoverEnable),"floorplanData"in p&&t(2,o=p.floorplanData),"cameraImageUrl"in p&&t(3,s=p.cameraImageUrl),"extraObjects"in p&&t(4,m=p.extraObjects)},r.$$.update=()=>{if(r.$$.dirty&228){const p=Math.min(i,c),{max:F,min:S}=o.bounding,O=F.x-S.x,T=F.y-S.y,q=function(){return O>T?[p,p/O*T]:[p/T*O,p]}();t(7,l=q[0]),t(10,g=q[1]),t(8,u=l/O)}},[n,a,o,s,m,i,c,l,u,f,g,v]}class Re extends z{constructor(e){super();H(this,e,Se,Fe,A,{five:0,hoverEnable:1,floorplanData:2,cameraImageUrl:3,extraObjects:4})}}class Ce{app;five;wrapperSelector="";data;wrapper=null;extraObjects;originExtraObjects;configs={};constructor(e,t){this.five=e,t?.configs&&Object.assign(this.configs,t.configs),typeof t?.wrapper=="string"?this.wrapperSelector=t.wrapper:t?.wrapper instanceof Element&&(this.wrapper=t.wrapper),e.once("dispose",this.dispose)}dispose=()=>{this.app?.$destroy()};load=async e=>{const t=JSON.parse(JSON.stringify(e)),n=await be(t);this.data=n,this.render()};appendTo(e){this.wrapper=e,this.render()}changeConfigs(e){Object.assign(this.configs,e),this.render()}setExtraObjectsWith3DPositions(e){this.originExtraObjects=e,!!this.data&&(this.extraObjects=L(e,this.five,this.data),this.render())}render(){if(!this.wrapper){const t=document.querySelector(this.wrapperSelector);this.wrapper=t}if(!this.data||!this.wrapper)return;!this.extraObjects&&this.originExtraObjects&&(this.extraObjects=L(this.originExtraObjects,this.five,this.data));const e={five:this.five,floorplanData:this.data,extraObjects:this.extraObjects,cameraImageUrl:this.configs.cameraImageUrl,hoverEnable:this.configs.hoverEnable??!1};if(!this.app){this.app=new Re({target:this.wrapper,props:e});return}this.app.$set(e)}}const Ue=(r,e)=>new Ce(r,e);function X(){return{width:window.innerWidth,height:window.innerHeight}}function Me(){const[r,e]=D.exports.useState(X);return D.exports.useEffect(()=>{const t=()=>e(X());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),r}const We=()=>{const[r,e]=le(),t=fe(),n=D.exports.useRef(null),[a,o]=D.exports.useState(!1);return D.exports.useEffect(()=>{!n.current||r.mode!==N.Mode.Panorama||(t.plugins.panoFloorplanRadarPlugin.appendTo(n.current),t.plugins.panoFloorplanRadarPlugin.load(te))},[]),D.exports.useEffect(()=>{r.mode===N.Mode.Panorama?o(!0):o(!1)},[r.mode]),W(ce,{onClick:()=>e({mode:N.Mode.Floorplan}),sx:{display:`${a?"flex":"none"}`,justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"90px",height:"120px",backgroundColor:"rgba(0, 0, 0, .2)"},ref:n})},ze={},Y=we(),He=JSON.stringify(Y)!=="{}"?Y:ze,Ae=me({plugins:[[Ue,"panoFloorplanRadarPlugin",{...He}]]}),Te=()=>{const r=Me();return B&&ue(Ae,{initialWork:ge(B),ref:e=>Object.assign(window,{$five:e?.five}),children:[W(he,{...r}),W(We,{})]})};pe.render(W(Te,{}),document.querySelector("#app"));
